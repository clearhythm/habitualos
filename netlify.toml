# =============================================================================
# Build & Dev
# =============================================================================

[build]
  command = "npm run build"
  publish = "_site"
  functions = "netlify/functions"

[dev]
  command = "npm run dev"
  targetPort = 8080
  autoLaunch = false

# =============================================================================
# Node.js Functions (netlify/functions/*.js)
# =============================================================================

[functions]
  node_bundler = "esbuild"
  included_files = ["docs/**/*.md"]

# Non-streaming chat endpoint - used as fallback when streaming fails
[functions."agent-chat"]
  timeout = 26  # Must complete before Netlify's 26s limit

# =============================================================================
# Edge Functions (netlify/edge-functions/*.ts)
# Deno runtime, runs at edge locations, no timeout issues with streaming
# =============================================================================

# Streaming chat endpoint - primary path, streams tokens via SSE
[[edge_functions]]
  path = "/api/agent-chat-stream"
  function = "agent-chat-stream"

# =============================================================================
# Redirects
# =============================================================================

# API gateway - routes /api/* to Node.js functions
# Edge functions at /api/* paths are handled before this redirect
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200
  force = true

# SPA-style routing for dynamic pages
[[redirects]]
  from = "/do/action/*"
  to = "/do/action/"
  status = 200
  force = true

[[redirects]]
  from = "/do/file/*"
  to = "/do/file/"
  status = 200
  force = true
