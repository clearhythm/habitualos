---
title: History - HabitualOS
layout: base.njk
permalink: /practice/history/
---

<div class="container-narrow" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 style="margin: 0;">History</h1>
    <a
      href="/practice/"
      style="padding: 0.75rem 1.5rem; background: #f0f0f0; color: #333; text-decoration: none; border-radius: 4px; font-weight: 600; border: 1px solid #ddd;"
    >
      ‚Üê Back
    </a>
  </div>

  <div id="loading" style="text-align: center; padding: 3rem; color: #999;">
    Loading check-ins...
  </div>

  <div id="practices-list" style="display: none;"></div>

  <div id="no-practices" style="display: none; text-align: center; padding: 3rem; color: #999;">
    <p>No check-ins yet.</p>
    <a href="/practice/" style="color: #0066cc; text-decoration: underline;">Log your first practice</a>
  </div>
</div>

<script type="module">
  import { initializeUser } from '/assets/js/auth/auth.js';
  import { renderPracticeEntryContent, initObiWaiEntries } from '/assets/js/practice-entry-renderer.js';

  async function loadPractices() {
    // Get userId from localStorage
    const userId = initializeUser();

    try {
      // Add timestamp to bust all caching layers
      const response = await fetch(`/.netlify/functions/practice-logs-list?userId=${userId}&_=${Date.now()}`, {
        cache: 'no-store',
        headers: {
          'Cache-Control': 'no-cache, no-store, must-revalidate',
          'Pragma': 'no-cache'
        }
      });
      const data = await response.json();

      const loading = document.getElementById('loading');
      const listEl = document.getElementById('practices-list');
      const noPracticesEl = document.getElementById('no-practices');

      loading.style.display = 'none';

      if (!data.success || data.practices.length === 0) {
        noPracticesEl.style.display = 'block';
        return;
      }

      listEl.style.display = 'block';

      // Render practices (no grouping, same style as detail page)
      const practicesHtml = data.practices.map(practice => {
        const date = new Date(practice.timestamp);
        const dateStr = date.toLocaleDateString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        const timeStr = date.toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: '2-digit'
        });

        return `
          <div style="padding: 1.5rem; background: white; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
              <div>
                <div style="font-weight: 600; color: #333; margin-bottom: 0.25rem;">
                  ${practice.practice_name || 'Practice'}
                </div>
                <div style="font-weight: 600; color: #666; margin-bottom: 0.25rem; font-size: 0.95rem;">
                  ${dateStr}
                </div>
                <div style="font-size: 0.9rem; color: #999;">
                  ${timeStr}
                </div>
              </div>
              ${practice.duration ? `
                <div style="text-align: right;">
                  <div style="font-size: 1.25rem; font-weight: 600; color: #0066cc;">
                    ${practice.duration}
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    minutes
                  </div>
                </div>
              ` : ''}
            </div>

            ${renderPracticeEntryContent(practice, {
              expandableInline: true,
              showFeedbackIcon: true
            })}
          </div>
        `;
      }).join('');

      listEl.innerHTML = practicesHtml;

      // Initialize expand/collapse and feedback for inline Obi-Wai entries
      initObiWaiEntries();

    } catch (error) {
      console.error('Error loading practices:', error);
      document.getElementById('loading').innerHTML = `
        <div style="color: #d32f2f;">
          Failed to load practices. Please refresh the page.
        </div>
      `;
    }
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Load practices on page load
  loadPractices();

  // Reload when page is shown (including from back/forward cache)
  window.addEventListener('pageshow', (event) => {
    if (event.persisted) {
      // Page was loaded from cache, reload data
      loadPractices();
    }
  });
</script>
